{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "Intelelphect",
  "scopeName": "source.php.ephect",
  "fileTypes": ["phpx", "phtml", "html.php"],
  "foldingStartMarker": "(/\\*|\\{\\s*$|<<<HTML)",
  "foldingStopMarker": "(\\*/|^\\s*\\}|^HTML;)",
  "injectionSelector": "L:source.php",
  "patterns": [
    {
      "include": "source.php"
    },
    {
      "include": "#ephect-specific-only"
    }
  ],
  "repository": {
    "ephect-specific-only": {
      "patterns": [
        {
          "include": "#heredoc-html"
        }
      ]
    },
    "heredoc-html": {
      "patterns": [
        {
          "name": "meta.embedded.block.html.ephect",
          "begin": "(<<<)\\s*(HTML)\\b",
          "beginCaptures": {
            "1": {
              "name": "keyword.operator.heredoc.php"
            },
            "2": {
              "name": "keyword.operator.heredoc.php"
            }
          },
          "end": "^\\s*(HTML)\\s*;?",
          "endCaptures": {
            "1": {
              "name": "keyword.operator.heredoc.php"
            }
          },
          "patterns": [
            {
              "include": "#ephect-template-directives"
            },
            {
              "include": "#ephect-variable-interpolation"
            },
            {
              "include": "#html-comment"
            },
            {
              "include": "#ephect-html-tag"
            }
          ]
        }
      ]
    },
    "ephect-template-directives": {
      "patterns": [
        {
          "name": "keyword.control.ephect",
          "match": "(@)(?:for|endfor|while|if|endif|elseif|else|do|done|break|continue|switch|case|default|op)\\b",
          "captures": {
            "1": {
              "name": "punctuation.definition.keyword.ephect"
            }
          }
        },
        {
          "name": "variable.other.ephect",
          "match": "(%)[a-zA-Z_][a-zA-Z0-9_]*(?:(?:->|\\.|::)[a-zA-Z_][a-zA-Z0-9_]*|\\[[^\\]]*\\])*",
          "captures": {
            "1": {
              "name": "punctuation.definition.variable.ephect"
            }
          }
        },
        {
          "name": "keyword.control.ephect",
          "match": "\\b(?:as|do)\\b"
        }
      ]
    },
    "ephect-variable-interpolation": {
      "patterns": [
        {
          "name": "meta.interpolation.ephect",
          "begin": "({{)\\s*",
          "beginCaptures": {
            "1": {
              "name": "punctuation.definition.template-expression.begin.ephect"
            }
          },
          "end": "\\s*(}})",
          "endCaptures": {
            "1": {
              "name": "punctuation.definition.template-expression.end.ephect"
            }
          },
          "patterns": [
            {
              "include": "#ephect-variables"
            }
          ]
        },
        {
          "name": "meta.interpolation.ephect.single",
          "begin": "({)(?!{)\\s*",
          "beginCaptures": {
            "1": {
              "name": "punctuation.definition.template-expression.begin.ephect"
            }
          },
          "end": "\\s*(})(?!})",
          "endCaptures": {
            "1": {
              "name": "punctuation.definition.template-expression.end.ephect"
            }
          },
          "patterns": [
            {
              "include": "#ephect-variables"
            }
          ]
        }
      ]
    },
    "ephect-variables": {
      "patterns": [
        {
          "name": "variable.other.ephect",
          "match": "(%)[a-zA-Z_][a-zA-Z0-9_]*",
          "captures": {
            "1": {
              "name": "punctuation.definition.variable.ephect"
            }
          }
        },
        {
          "name": "meta.property-access.ephect",
          "match": "(->)([a-zA-Z_][a-zA-Z0-9_]*)",
          "captures": {
            "1": {
              "name": "keyword.operator.class.php"
            },
            "2": {
              "name": "variable.other.property.ephect"
            }
          }
        },
        {
          "name": "variable.other.php",
          "match": "(\\$)[a-zA-Z_][a-zA-Z0-9_]*",
          "captures": {
            "1": {
              "name": "punctuation.definition.variable.php"
            }
          }
        }
      ]
    },
    "html-comment": {
      "patterns": [
        {
          "name": "comment.block.html",
          "begin": "<!--",
          "end": "-->",
          "captures": {
            "0": {
              "name": "punctuation.definition.comment.html"
            }
          }
        }
      ]
    },
    "ephect-html-tag": {
      "patterns": [
        {
          "name": "meta.tag.html",
          "begin": "(<)([a-zA-Z][a-zA-Z0-9:-]*)",
          "beginCaptures": {
            "1": {
              "name": "punctuation.definition.tag.begin.html"
            },
            "2": {
              "name": "entity.name.tag.html"
            }
          },
          "end": "(/?>)",
          "endCaptures": {
            "1": {
              "name": "punctuation.definition.tag.end.html"
            }
          },
          "patterns": [
            {
              "include": "#ephect-variable-interpolation"
            },
            {
              "include": "#html-attribute"
            }
          ]
        },
        {
          "name": "meta.tag.html",
          "begin": "(</)([a-zA-Z][a-zA-Z0-9:-]*)",
          "beginCaptures": {
            "1": {
              "name": "punctuation.definition.tag.begin.html"
            },
            "2": {
              "name": "entity.name.tag.html"
            }
          },
          "end": "(>)",
          "endCaptures": {
            "1": {
              "name": "punctuation.definition.tag.end.html"
            }
          }
        }
      ]
    },
    "html-attribute": {
      "patterns": [
        {
          "name": "meta.attribute.html",
          "begin": "([a-zA-Z:][a-zA-Z0-9:_.-]*)\\s*(=)\\s*(\")",
          "beginCaptures": {
            "1": {
              "name": "entity.other.attribute-name.html"
            },
            "2": {
              "name": "punctuation.separator.key-value.html"
            },
            "3": {
              "name": "punctuation.definition.string.begin.html"
            }
          },
          "end": "\"",
          "endCaptures": {
            "0": {
              "name": "punctuation.definition.string.end.html"
            }
          },
          "contentName": "string.quoted.double.html",
          "patterns": [
            {
              "include": "#ephect-variable-interpolation"
            }
          ]
        },
        {
          "name": "meta.attribute.html",
          "begin": "([a-zA-Z:][a-zA-Z0-9:_.-]*)\\s*(=)\\s*(')",
          "beginCaptures": {
            "1": {
              "name": "entity.other.attribute-name.html"
            },
            "2": {
              "name": "punctuation.separator.key-value.html"
            },
            "3": {
              "name": "punctuation.definition.string.begin.html"
            }
          },
          "end": "'",
          "endCaptures": {
            "0": {
              "name": "punctuation.definition.string.end.html"
            }
          },
          "contentName": "string.quoted.single.html",
          "patterns": [
            {
              "include": "#ephect-variable-interpolation"
            }
          ]
        },
        {
          "name": "entity.other.attribute-name.html",
          "match": "[a-zA-Z:][a-zA-Z0-9:_.-]*"
        }
      ]
    },
    "ephect-in-html-attributes": {
      "patterns": [
        {
          "include": "#ephect-variable-interpolation"
        }
      ]
    }
  },
  "injections": {
    "L:meta.embedded.block.html.ephect string.quoted": {
      "patterns": [
        {
          "include": "#ephect-variable-interpolation"
        }
      ]
    }
  }
}
